--- 
dist: bionic
matrix: 
  include: 
    - 
      before_install:
        - sudo apt install -y openjdk-11-jre
      before_script: 
        - "bash vm-prep/make-fixtures.sh"
        - "cd readthedocs/code-tabs/bash"
      language: bash
      name: "Bash snippets using xenon-cli"
      script: 
        - "echo 'maybe later'"
    - 
      before_install:
        - sudo apt install -y openjdk-11-jre
      before_cache: 
        - "rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock"
        - "rm -fr $HOME/.gradle/caches/*/plugin-resolution/"
      before_script: 
        - "bash vm-prep/make-fixtures.sh"
        - "cd readthedocs/code-tabs/java"
      cache: 
        directories: 
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
      jdk: openjdk11
      language: java
      name: "Java snippets that use xenon library directly"
      script: 
        - "./gradlew check"
    - 
      services:
        - docker
      before_install:
        - sudo apt install -y openjdk-11-jre
        - docker pull nlesc/xenon-slurm:17
        - docker run --detach --publish 10022:22 --hostname slurm17 nlesc/xenon-slurm:17
      before_script: 
        - "bash vm-prep/make-fixtures.sh"
        - "cd readthedocs/code-tabs/python"
      language: python
      name: "Python snippets using pyxenon and xenon-grpc"
      install:
        - pip install -r readthedocs/code-tabs/python/requirements.txt
      script: 
        - pytest tests/
notifications: 
  email: 
    on_failure: change
    on_succes: never

