\chapter{Eclipse}

So now that we've verified that everything works, we can start thinking about doing some development work. Let's first look at the Java editor Eclipse.

Eclipse\index{Eclipse} is a very powerful, free, open-source, integrated development environment for Java (and many other languages). It is available in most Linuxes from their respective repositories. By default, Eclipse comes with many features, such as Git (version control)\index{Git}, Mylyn (task management)\index{Mylyn}, Maven (building)\index{Maven}, Ant (building)\index{Ant}, an XML editor, as well as some other stuff. While these features are nice, they can get in the way if you're new to code development with Java using Eclipse. We will therefore set up a minimal Eclipse installation which includes only the Eclipse platform and the Java related tools (most importantly, the debugger). Feel free to skip this next part if you're already familiar with Eclipse.

\section{A minimal Eclipse installation}
\index{Eclipse!minimal installation}

Go to \url{http://download.eclipse.org/eclipse/downloads/}. Under `Latest release', click on the link with the highest version number. It will take you to a website that has a menu in the upper left corner. From that menu, select the item `Platform Runtime binary', then download the file corresponding to your platform (for me, that is \url{eclipse-platform-4.5-linux-gtk-x86_64.tar.gz}). Go back to the menu by scrolling up, then select the item `JDT Runtime binary', and download the file (there should be only one; for me that is \url{org.eclipse.jdt-4.5.zip}).

Now go to where you downloaded those two files to. Uncompress \url{eclipse-platform-4.5-linux-gtk-x86_64.tar.gz} and move the uncompressed files to a new directory \mytilde\url{/opt/minimal-eclipse/} (they can be anywhere, really, but \mytilde\url{/opt} is the conventional place to install user-space programs on Linux). Start Eclipse by running \url{eclipse} from \mytilde\url{/opt/minimal-eclipse/eclipse}.

In Eclipse's menu go to \textsf{Help}, then select \textsf{Install New Software...}. Near the bottom of the dialog, uncheck \textsf{Group items by category}. Then click the top-right button labeled \textsf{Add...} and click \textsf{Archive...}. Then navigate to the second file you downloaded, \url{org.eclipse.jdt-4.5.zip} and select it. In the dialog, a new item \textsf{Eclipse Java Development Tools} should appear. Make sure it's checked, then click \textsf{Next} and \textsf{Finish}. When Eclipse restarts, you should have everything you need for Java development, without any of the clutter!

\index{Bash!alias}
\index{Bash!alias!miniclipse@\texttt{miniclipse}}

Adding a Bash alias to \mytilde\url{/.bash_aliases} will make it easier to start the program. I've used
\begin{lstlisting}[style=basic,style=bash,escapeinside={(*@}{@*)}]
echo "alias miniclipse='${HOME}/opt/minimal-eclipse/eclipse/eclipse'" >> \
${HOME}/.bash_aliases
\end{lstlisting}
to do so (restart your terminal to use the \texttt{miniclipse} alias).

\section{Automatic project setup with \texttt{gradlew}}

\index{Eclipse!automatic project setup}
\index{Eclipse!gradle eclipse@\texttt{gradle eclipse}}
\index{Eclipse!./gradlew eclipse@\texttt{./gradlew eclipse}}
\index{Gradle!automatic Eclipse project setup}
\index{Gradle!gradle eclipse@\texttt{gradle eclipse}}
\index{Gradle!./gradlew eclipse@\texttt{./gradlew eclipse}}

Normally, when you start a new project in Eclipse, it takes you through a series of dialogs to set up the Eclipse project in terms of the directory structure, the classpath, etc. The configuration is saved to (hidden) files \url{.project}, \url{.classpath}, and \url{.settings/org.eclipse.jdt.core.prefs}. The dialogs offer some freedom in setting up the project. This flexibility is great when you're working on some project by yourself, but when there are multiple people working together, one developer may have a different project setup than the next, and so bugs are introduced. That's why we will use \texttt{gradlew} to generate a standard project setup for us:

\Needspace{5\baselineskip}
\begin{lstlisting}[style=basic,style=bash,escapeinside={(*@}{@*)}]
cd ${HOME}/Xenon-examples
./gradlew eclipse
\end{lstlisting} % dummy $

\section{Opening the Xenon examples in Eclipse}
\index{Xenon examples!in Eclipse}
\index{Eclipse!new project}

After the Eclipse files have been generated, start Eclipse by typing the Bash alias \texttt{miniclipse} at the command line. From Eclipse's menu, select \textsf{File}$\rightarrow$\textsf{Import}. In the \textsf{Select} dialog, select \textsf{Existing projects into Workspace}, then click the button labeled \textsf{Next}.

In the next dialog (\textsf{Import projects}), use the \textsf{Browse...} button to select the project's root directory, e.g. \url{/home/daisycutter/Xenon-examples}, then click \textsf{Finish}. An item \textsf{Xenon-examples} should now be visible in the \textsf{Package explorer} pane. Expand it, and navigate to \url{src/main/java/}, then double-click \textsf{DirectoryListing.java} from the \textsf{nl.esciencecenter.xenon.examples.files} package to view its code in the editor pane.




\section{Running a Java program in Eclipse}
\index{Eclipse!Running a Java program}
\index{Running a Java program in Eclipse}
\index{Java!Running a Java program in Eclipse}

So now that we have the source code open in the editor, let's see if we can run it. You can start the program in a couple different ways. For example, you can select \textsf{Run}$\rightarrow$\textsf{Run}; you can use the key binding \textsf{Ctrl+F11}, or you can press the `Play' icon in Eclipse's GUI. If you try to run the program, however, you will get the error we saw earlier at the command line (Eclipse prints the program's output to the pane labeled \textsf{Console}):
\begin{lstlisting}[style=basic,style=bash,language=java,escapeinside={(*@}{@*)}]
time   : 18:42:04.689 (+219 ms)
thread : main
level  : ERROR
class  : nl.esciencecenter.xenon.examples.files.DirectoryListing:51
message: Example requires a URI as parameter!
\end{lstlisting}

So somehow we have to tell Eclipse about the URI (including both its scheme and its path) that we want to use to get to the contents of a directory of our chosing. You can do this through so-called `Run configurations'\index{Eclipse!Run configurations}. You can make a new run configuration by selecting \textsf{Run} from the Eclipse menu, then \textsf{Run configurations...}. In the left pane of the dialog that pops up, select \textsf{Java Application}, then press the \textsf{New launch configuration} button in the top left of the dialog. A new run configuration item should now become visible under \textsf{Java Application}. By default, the name of the run configuration will be the name of the class, but you can change the name to whatever you like. When you select the \textsf{DirectoryListing} run configuration in the left pane, the right pane changes to show the details of the run configuration. The information is divided over a few tabs. Select the tab labeled \textsf{Arguments}. You should see a field named \textsf{Program arguments} where you can provide the arguments that you would normally pass through the command line. Earlier, we passed the string \texttt{file:\$\{PWD\}}, but that won't work here, since \texttt{\$\{PWD\}} is a Bash environment variable, and thus not directly available from within Eclipse. Eclipse does provide a workaround for this by way of the \texttt{env\_var} variable. \texttt{env\_var} takes exactly one argument, namely the name of an environment variable, such as \texttt{PWD}. The correct text to enter into \textsf{Program arguments} thus becomes \texttt{file:\$\{env\_var:PWD\}}. Note that \texttt{\$\{env\_var:PWD\}} refers to the directory that Eclipse was started from.





\section{Debugging a Java program in Eclipse}

\index{Eclipse!Debugging a Java program}
\index{Debugging a Java program in Eclipse}
\index{Java!Debugging a Java program in Eclipse}



In my opinion, one of the most helpful features of the Eclipse interface is the debugging/inspecting variables capability. This lets you run your program line-by-line. To start debugging, you have to set a breakpoint first. Program execution will halt at this point, such that you can inspect what value each variable has at that point in your program. Setting a breakpoint is most easily accomplished by double-clicking the left margin of the editor; a blue dot will appear. Alternatively, you can press \textsf{Ctrl+Shift+b} to set a breakpoint at the current line.

Set a breakpoint at the line
\begin{lstlisting}[style=basic,style=bash,language=java,escapeinside={(*@}{@*)}]
URI uri = new URI(args[0]);
\end{lstlisting}

Now we need to set the debug configuration in a similar manner as we did for the run configuration. Select \textsf{Run} from the menu, select \textsf{Debug configurations...} (not \textsf{Run configurations...}), then select the configuration we used previously.

Run the program up to the position of the breakpoint. There are various ways to start a debug run: e.g. by selecting \textsf{Run}$\rightarrow$\textsf{Debug}; or by pressing \textsf{F11}.

You can add all kinds of helpful tools to the Eclipse window; for an overview of your options, click the \textsf{Window} menu item, then select \textsf{Show view}, then select \textsf{Other...}. Select whatever tools you like, but make sure to select the \textsf{Variables} tool from \textsf{Debug}. This tool allows you to view information about your variables while you're debugging. Use drag and drop to lay out the Eclipse window to suit your needs. Eclipse refers to its window layout as a `perspective'\index{Eclipse!perspective}; perspectives can be saved by subsequently selecting \textsf{Window}, \textsf{Perspective}, and \textsf{Save perspective as...}. This allows you to have custom perspectives for development in different languages (Java, Python, C, etc.), or for different screen setups (laptop screen v. side-by-side 1920x1080 for example), or for different tasks (Java development v. Java debugging for example).

Getting back to \textsf{DirectoryListing}, execution has been halted just before the line \texttt{URI uri = new URI(args[0]);} was executed. If you now look in the \textsf{Variables} tool pane, there should be only one variable visible: \texttt{args}, which contains the string we supplied through the \textsf{Program arguments} of the debug configuration.

Press \textsf{F6} to evaluate the line. You'll see a new variable \texttt{uri} of type \texttt{URI} appear in the \textsf{Variables} pane. Expand the object to inspect it in more detail.

When you're done inspecting, press \textsf{F8} to make Eclipse evaluate your program, either up to the next breakpoint, or if there are no breakpoints, up to the end your program.

Finally, you can terminate a debug run by pressing \textsf{Ctrl+F2}. Table~\ref{tab:key-bindings-eclipse} summarizes some of the most common Eclipse key bindings used in running and debugging Java programs.


\begin{table}[!ht]
\vspace{1.0em}
\caption{Default key bindings used for running and debugging Java programs in Eclipse.\label{tab:key-bindings-eclipse}\index{Eclipse!key bindings}}
\begin{tabular}{lp{10cm}}
\vspace{0.5em}
\textbf{Default key binding} & \textbf{Description}                  \\
\textsf{F5}                  & Step in                               \\
\textsf{F6}                  & Step over                             \\
\textsf{F7}                  & Step return                           \\
\textsf{F8}                  & Continue to the next breakpoint       \\
\textsf{F11}                 & Start a debug run                     \\
\textsf{Ctrl+F2}             & Terminate a debug run                 \\
\textsf{Ctrl+Shift+b}        & Set a breakpoint at the current line  \\
\textsf{Ctrl+F11}            & Start a (non-debug) run               \\
\end{tabular}
\end{table}

\section{Setting the log level}

Earlier, we looked at how to pass custom \texttt{loglevel} values to \texttt{java} using command line parameters such as \texttt{-Dloglevel=DEBUG} (see section \ref{sec:setting-the-log-level-command-line}). Passing command line parameters is also possible in Eclipse, by altering the debug configuration (or run configuration) as follows. In Eclipse's menu, go to \textsf{Run} and select either \textsf{Run configurations...} or \textsf{Debug configurations...} as appropriate. Then, in the left pane, select the Java application whose configuration you want to adapt. In the right-hand pane, subsequently select the tab labeled \textsf{Arguments}. The second text field from the top should be labeled \textsf{VM~arguments}\index{Eclipse!VM arguments}. Here you can add command line parameters to the java program, such as \texttt{-Dloglevel=DEBUG}.
